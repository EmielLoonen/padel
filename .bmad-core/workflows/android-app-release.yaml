workflow:
  id: android-app-release
  name: Android App Store Release
  description: >-
    End-to-end workflow for releasing Android applications to Google Play Store.
    Covers development completion through store submission and post-release monitoring.
  type: deployment
  platform: android
  project_types:
    - android-app
    - mobile-app
    - enterprise-android

  sequence:
    - agent: android-dev
      action: final_development_validation
      uses: android-dev-checklist
      notes: "Complete final development validation using android-dev-checklist. Ensure all features are complete and tested."

    - agent: qa
      action: comprehensive_testing
      creates: test-report.md
      requires: completed_development
      notes: |
        Comprehensive QA testing:
        - Manual testing on multiple Android devices (12-16)
        - Performance testing and memory leak detection
        - Security vulnerability testing
        - Accessibility compliance testing
        - Network connectivity edge cases

    - agent: android-dev
      action: address_qa_issues
      condition: qa_found_issues
      notes: "Address any critical issues found during QA testing. Re-run android-dev-checklist after fixes."

    - agent: security
      action: security_review
      creates: security-assessment.md
      requires: qa_approval
      optional_steps:
        - penetration_testing
        - dependency_vulnerability_scan
      notes: "Security review focused on Android-specific vulnerabilities, data protection, and privacy compliance."

    - agent: devops
      action: configure_fastlane
      creates: fastlane_config
      requires: security_approval
      notes: |
        Fastlane configuration verification:
        - Verify Fastfile configuration for Android
        - Check Google Play Console API credentials
        - Validate signing certificates and keystore
        - Review lane configurations (beta, release, screenshots)
        - Test Fastlane environment setup

    - agent: devops
      action: fastlane_beta_release
      creates: beta_release
      uses: fastlane_beta_lane
      requires: fastlane_config
      notes: |
        Fastlane beta release:
        - Run fastlane beta lane
        - Automated build, sign, and upload to internal testing
        - Generate release notes from git commits
        - Automated screenshot generation if configured
        - Upload to Google Play Console internal track

    - agent: qa
      action: beta_build_validation
      requires: beta_release
      notes: |
        Beta build validation:
        - Download and install from Play Console internal track
        - Verify all app functionality works in release build
        - Test ProGuard/R8 optimizations don't break functionality
        - Performance testing on release build
        - Crash reporting integration testing

    - play_store_preparation:
      action: prepare_store_metadata
      creates: store_metadata
      notes: |
        Google Play Store metadata preparation:
        - Update Fastlane metadata files (title, description, changelog)
        - Prepare store listing content in fastlane/metadata/android/
        - Update privacy policy and terms of service links
        - Configure age rating and content guidelines
        - Review promotional graphics and screenshots

    - agent: pm
      action: store_metadata_review
      updates: store_metadata
      requires: store_metadata
      notes: "Review and approve Google Play Store metadata, descriptions, and marketing materials in Fastlane configuration."

    - agent: devops
      action: fastlane_screenshot_generation
      creates: automated_screenshots
      requires: store_metadata_review
      optional: true
      notes: |
        Automated screenshot generation (optional):
        - Run fastlane screenshots lane
        - Generate screenshots for multiple device types
        - Update Play Console with new screenshots
        - Verify screenshots appear correctly in store listing

    - stakeholder_approval:
      action: final_approval
      requires: internal_track_release
      notes: |
        Final stakeholder approval:
        - Business stakeholder testing and approval
        - Legal/compliance final review
        - Marketing team coordination
        - Go/no-go decision for production release

    - agent: devops
      action: fastlane_production_release
      creates: production_release
      uses: fastlane_release_lane
      requires: stakeholder_approval
      condition: approved_for_production
      notes: |
        Fastlane production release:
        - Run fastlane release lane
        - Automated promotion from beta to production track
        - Configure staged rollout percentage (1%, 5%, 10%, 100%)
        - Automated release notes from git commits or metadata
        - Upload final AAB/APK to production track
        - Monitor Fastlane output for any deployment issues

    - post_release_monitoring:
      action: monitor_release
      duration: 48_hours
      notes: |
        Post-release monitoring:
        - Monitor crash reports and ANRs
        - Track user reviews and ratings
        - Monitor key performance metrics
        - Watch for any critical issues requiring hotfix

    - agent: pm
      action: release_retrospective
      creates: release-retrospective.md
      condition: monitoring_complete
      optional: true
      notes: |
        OPTIONAL: Release retrospective
        - Document lessons learned
        - Identify process improvements
        - Review release timeline and bottlenecks
        - Plan improvements for next release

  flow_diagram: |
    ```mermaid
    graph TD
        A[Start: Android Release] --> B[android-dev: Final validation]
        B --> C[qa: Comprehensive testing]
        C --> D{QA Issues?}
        D -->|Yes| E[android-dev: Fix issues]
        D -->|No| F[security: Security review]
        E --> C
        F --> G[devops: Configure Fastlane]
        G --> H[devops: Fastlane beta release]
        H --> I[qa: Beta build validation]
        I --> J[Prepare store metadata]
        J --> K[pm: Store metadata review]
        K --> L{Screenshots needed?}
        L -->|Yes| L1[devops: Fastlane screenshots]
        L -->|No| M[Stakeholder approval]
        L1 --> M
        M --> N{Approved?}
        N -->|No| O[Address concerns]
        N -->|Yes| P[devops: Fastlane production release]
        O --> M
        P --> Q[Post-release monitoring]
        Q --> R{Issues found?}
        R -->|Yes| S[Emergency hotfix process]
        R -->|No| T[pm: Release retrospective]
        S --> T
        T --> U[Release Complete]

        style U fill:#90EE90
        style P fill:#FFB6C1
        style F fill:#F0E68C
        style C fill:#ADD8E6
        style B fill:#E6E6FA
    ```

  decision_guidance:
    when_to_use:
      - Android app ready for Google Play Store release
      - Production mobile application deployment
      - Enterprise Android app distribution
      - App updates requiring store approval

    rollback_strategy:
      - Use Play Console to halt rollout if critical issues found
      - Prepare hotfix release process for critical bugs
      - Maintain previous APK version for emergency rollback
      - Monitor user feedback and crash reports closely

  handoff_prompts:
    dev_to_qa: "Development complete. Application ready for comprehensive QA testing on Android devices."
    qa_to_security: "QA testing passed. Application ready for security review and vulnerability assessment."
    security_to_fastlane: "Security review complete. Ready for Fastlane configuration and beta release."
    fastlane_to_qa: "Fastlane beta release deployed to internal track. Ready for beta build validation."
    qa_to_metadata: "Beta build validated. Ready for store metadata preparation and review."
    metadata_to_production: "Store metadata approved. Ready for Fastlane production release."
    production_monitoring: "Fastlane production release deployed. Begin 48-hour monitoring phase for stability."
